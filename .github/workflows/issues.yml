name: Publish
on: 
  push:
  schedule:
    - cron: '*/1 * * * *'
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2.3.1

      - name: Get issues
        run: |
          _TMPDIR=./tmp.gh-pages.${GITHUB_RUN_ID}
          echo use ${_TMPDIR}
          
          mkdir "${_TMPDIR}"

          date > ./${_TMPDIR}/date.txt
          ./scripts/issues-dump.sh > ./${_TMPDIR}/issues.csv

      - name: Cleanup
        if: always()
        run: |
          _TMPDIR=./tmp.gh-pages.${GITHUB_RUN_ID}
          rm -rf ${_TMPDIR}

      - name: Publish CSV
        uses: JamesIves/github-pages-deploy-action@4.1.5
        with:
          branch: gh-pages 
          folder: tmp.gh-pages.${{ github.run_id }}
          single-commit: true


